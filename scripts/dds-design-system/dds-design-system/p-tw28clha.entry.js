import{r as t,d as s,h as i,H as e,c as l}from"./p-31571bfb.js";import"./p-6a55da7d.js";import"./p-0686f415.js";import"./p-3e9f19ec.js";import{c as d,C as h,a,i as o,b as n,g as r,d as c,o as u}from"./p-c25b6b30.js";var p;!function(t){t.andClicked="andClicked",t.orClicked="orClicked",t.removeClicked="removeClicked"}(p||(p={}));const v=class{constructor(i){t(this,i),this.operator="=",this.value1="",this.value2="",this.isCreatingFilter=!1,this.andClicked=s(this,"andClicked",7),this.orClicked=s(this,"orClicked",7),this.removeClicked=s(this,"removeClicked",7),this.filterChanged=s(this,"filterChanged",7)}rePopulateValues(){if(this.filter.column){const t=this.getFormatTypeFromColumn(this.filter.column);this.filter=Object.assign(Object.assign({},this.filter),{columnFormatType:t})}"="!==this.filter.opOrFun&&"<>"!==this.filter.opOrFun||"na"!==this.filter.values[0].toLowerCase()?(this.operator=this.filter.opOrFun,this.filter.values.length>0&&(this.value1=this.filter.values[0]),this.filter.values.length>1&&(this.value2=this.filter.values[1]),this.emitFilterChanged(),this.isCreatingFilter=!1):this.operator="="===this.filter.opOrFun?"na":"!na"}async createNewFilter(t={}){this.isCreatingFilter=!0,this.filter=d(t),this.rePopulateValues()}componentWillLoad(){if(!this.columns)throw new Error("dds-filter requires a valid array of columns");this.filter&&(this.isCreatingFilter=!0,this.rePopulateValues())}componentDidLoad(){this.emitFilterChanged()}emitFilterChanged(){this.filter&&!this.isCreatingFilter&&this.filterChanged.emit({filter:this.filter})}updateValue1(){const t=[this.value1,this.filter.values[1]];this.filter=Object.assign(Object.assign({},this.filter),{values:t}),this.emitFilterChanged()}updateValue2(){const t=[this.filter.values[0],this.value2];this.filter=Object.assign(Object.assign({},this.filter),{values:t}),this.emitFilterChanged()}getValueFromColumn(t){const s=this.columns.filter(s=>s.name===t);return s?s[0]:void 0}getFormatTypeFromColumn(t){if(!t)return;const s=this.columns.find(s=>s.name===t);if(!s)return;const i=s.displayFormatting&&s.displayFormatting.colorType||s.type;if(i){if(h.text.includes(i))return a.text;if(h.date.includes(i))return a.date;if(h.numeric.includes(i))return a.numeric}}onInputValue1(t){this.value1=t.target.value,this.value2&&!o(this.operator)&&(this.value2=void 0)}onClick(t){this[t].emit({id:this.filter.id}),this.el.querySelector("dds-dropdown").hide()}onChangeOperator(t){let s=t.detail.value;this.operator=s,n(s)?(s="na"===s?"=":"<>",this.filter.values=["na"]):this.filter=o(s)?Object.assign(Object.assign({},this.filter),{values:[this.value1,this.value2]}):Object.assign(Object.assign({},this.filter),{values:[this.value1]}),this.filter=Object.assign(Object.assign({},this.filter),{opOrFun:s}),this.emitFilterChanged()}onChangeColumn(t){const s=t.detail.value,i=this.getValueFromColumn(s).type;r(this.operator).allowedTypes.includes(i)||(this.operator="=",this.filter=Object.assign(Object.assign({},this.filter),{values:[this.value1],opOrFun:"="}));const e=this.getFormatTypeFromColumn(s);this.filter=Object.assign(Object.assign({},this.filter),{column:s,columnFormatType:e}),this.emitFilterChanged()}render(){if(!this.filter)return;const t=this.filter.column&&this.getValueFromColumn(this.filter.column).type===c.date?"date":void 0,s=o(this.operator)?i("div",null,i("div",{class:"dds-filter__multiple-values"},i("div",null,i("dds-label",{class:"dds-filter__label","component-id":"value1"},"Value 1"),i("dds-input",{id:"value1",value:this.value1,type:t,onInput:t=>this.onInputValue1(t)})),i("div",{class:"dds-filter__value-separator"},"â€“"),i("div",null,i("dds-label",{class:"dds-filter__label","component-id":"value2"},"Value 2"),i("dds-input",{id:"value2",value:this.value2,type:t,onInput:t=>this.value2=t.target.value})))):1===r(this.operator).numberOfInputs?i("div",null,i("dds-label",{class:"dds-filter__label","component-id":"value"},"Value"),i("dds-input",{id:"value",value:this.value1,type:t,onInput:t=>this.onInputValue1(t)})):void 0,l=i("div",{class:"dds-filter__dropdown"},i("dds-dropdown",null,i("div",null,i("dds-list-item",{button:!0,onClick:()=>this.onClick(p.andClicked)},"And"),i("dds-list-item",{button:!0,onClick:()=>this.onClick(p.orClicked)},"Or"),i("dds-list-item",{button:!0,onClick:this.isFirstFilter?void 0:()=>this.onClick(p.removeClicked),disabled:this.isFirstFilter},"Remove")))),d=u.filter(this.filter.column?t=>t.allowedTypes.includes(this.getValueFromColumn(this.filter.column).type):t=>t.allowedTypes.length>=5);return i(e,{id:"dds-filter-"+this.filter.id},i("div",{class:"dds-filter__container"},i("div",{class:n(this.operator)?void 0:"dds-filter__full-row"},i("div",{class:"dds-filter__column-operator"},i("div",{id:"dds-filter__column"},i("dds-label",{class:"dds-filter__label"},"Column"),i("dds-select",{onDdsSelectValueChanged:t=>this.onChangeColumn(t),placeholder:"Select a column"},this.columns.map(t=>i("dds-select-option",{value:t.name,selected:this.filter.column===t.name,key:t.name},t.label)))),i("div",{id:"dds-filter__operator"},i("dds-label",{class:"dds-filter__label"},"Operator"),i("dds-select",{onDdsSelectValueChanged:t=>this.onChangeOperator(t)},d.map(t=>i("dds-select-option",{value:t.value,selected:this.operator===t.value,key:t.value},t.label)))))),n(this.operator)?l:void 0,s,n(this.operator)?void 0:l))}get el(){return l(this)}static get watchers(){return{value1:["updateValue1"],value2:["updateValue2"]}}static get style(){return".dds-filter__container{display:grid;grid-gap:8px;grid-template-columns:auto 28px}.dds-filter__multiple-values{display:grid;grid-template-columns:auto 8px auto;grid-gap:4px}.dds-filter__column-operator{display:grid;grid-template-columns:auto auto;grid-gap:8px}.dds-filter__full-row{grid-column:1/span 2}.dds-filter__dropdown{margin-top:17px}.dds-filter__label{text-transform:uppercase}.dds-filter__value-separator{padding-top:21px;text-align:center;color:var(--color-grey-01)}"}};export{v as dds_filter};